{% extends 'base.html.twig' %}

{% block title %}{{ parent() }}Events{% endblock %}

{% block body %}
<div class="container px-sm-0 px-5">
  <h1 class="my-3">Events</h1>
  <div class="mb-3 d-flex flex-row flex-wrap gap-2">
    <a href="{{ path('app_event_new') }}" class="btn btn-primary">Create New</a>
    <a href="{{ path('app_event_type_index') }}" class="btn btn-secondary">Manage Event Types</a>
    <form method="GET" action="{{ path('app_event_index') }}">
      <select id="eventTypeSelect" name="eventTypeId" class="form-select" onchange="this.form.submit()">
        <option value="">All Event Types</option>
        {% for eventType in eventTypes %}
        <option value="{{ eventType.id }}" {% if eventType.id==selectedEventTypeId %}selected{% endif %}>
          {{ eventType.name }}
        </option>
        {% endfor %}
      </select>
    </form>
  </div>
  <div class="row row-cols-xl-4 row-cols-lg-3 row-cols-sm-2 row-cols-1 g-3">
    {% for event in events %}
    <div>
      <div class="card" style="min-height: 33rem">
        <img src="{{ event.image }}" class="card-img-top" alt="{{ event.name }}">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ names[loop.index0] }}</h5>

          <h6 class="card-subtitle mb-1 text-body-secondary">
            {% if event.address %}{{ event.address.locationName }}
            {% else %}Unknown location
            {% endif %}
          </h6>
          {% if (event.startTime|date('d M Y')) != (event.endTime|date('d M Y')) %}
          <p class="card-text mb-2 text-body-tertiary">{{ event.startTime ? event.startTime|date('d M Y') : '' }}
            &ndash; {{
            event.endTime ?
            event.endTime|date('d M Y') : '' }}</p>
          {% else %}
          <p class="card-text mb-2 text-body-tertiary">{{ event.startTime ? event.startTime|date('d M Y H:i') : '' }}
          </p>
          {% endif %}

          <p class="card-text">{{ (shortDescriptions[loop.index0])|nl2br }}</p>
          <div style="flex-grow: 1;"></div>
          <div class="d-flex flex-row gap-2">
            <a href="{{ path('app_event_show', {'id': event.id}) }}" class="btn btn-primary">Details</a>
            <a href="{{ path('app_event_edit', {'id': event.id}) }}" class="btn btn-success">Edit</a>
            {{ include('event/_delete_form.html.twig') }}
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <p>No events found</p>
    {% endfor %}
  </div>
</div>

{% endblock %}